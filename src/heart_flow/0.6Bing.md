- **智能化 MaiState 状态转换**:
    - 当前 `MaiState` (整体状态，如 `OFFLINE`, `NORMAL_CHAT` 等) 的转换逻辑 (`MaiStateManager`) 较为简单，主要依赖时间和随机性。
    - 未来的计划是让主心流 (`Heartflow`) 负责决策自身的 `MaiState`。
    - 该决策将综合考虑以下信息：
        - 各个子心流 (`SubHeartflow`) 的活动状态和信息摘要。
        - 主心流自身的状态和历史信息。
        - (可能) 结合预设的日程安排 (Schedule) 信息。
    - 目标是让 Mai 的整体状态变化更符合逻辑和上下文。 (计划在 064 实现)

- **参数化与动态调整聊天行为**:
    - 将 `NormalChatInstance` 和 `HeartFlowChatInstance` 中的关键行为参数（例如：回复概率、思考频率、兴趣度阈值、状态转换条件等）提取出来，使其更易于配置。
    - 允许每个 `SubHeartflow` (即每个聊天场景) 拥有其独立的参数配置，实现"千群千面"。
    - 开发机制，使得这些参数能够被动态调整：
        - 基于外部反馈：例如，根据用户评价（"话太多"或"太冷淡"）调整回复频率。
        - 基于环境分析：例如，根据群消息的活跃度自动调整参与度。
        - 基于学习：通过分析历史交互数据，优化特定群聊下的行为模式。
    - 目标是让 Mai 在不同群聊中展现出更适应环境、更个性化的交互风格。

- **动态 Prompt 生成与人格塑造**:
    - 当前 Prompt (提示词) 相对静态。计划实现动态或半结构化的 Prompt 生成。
    - Prompt 内容可根据以下因素调整：
        - **人格特质**: 通过参数化配置（如友善度、严谨性等），影响 Prompt 的措辞、语气和思考倾向，塑造更稳定和独特的人格。
        - **当前情绪**: 将实时情绪状态融入 Prompt，使回复更符合当下心境。
    - 目标：提升 `HeartFlowChatInstance` (HFC) 回复的多样性、一致性和真实感。
    - 前置：需要重构 Prompt 构建逻辑，可能引入 `PromptBuilder` 并提供标准接口 (认为是必须步骤)。

- **扩展观察系统 (Observation System)**:
    - 目前主要依赖 `ChattingObservation` 获取消息。
    - 计划引入更多 `Observation` 类型，为 `SubHeartflow` 提供更丰富的上下文：
        - Mai 的全局状态 (`MaiStateInfo`)。
        - `SubHeartflow` 自身的聊天状态 (`ChatStateInfo`) 和参数配置。
        - Mai 的系统配置、连接平台信息。
        - 其他相关聊天或系统的聚合信息。
    - 目标：让 `SubHeartflow` 基于更全面的信息进行决策。

- **增强工具调用能力 (Enhanced Tool Usage)**:
    - 扩展 `HeartFlowChatInstance` (HFC) 可用的工具集。
    - 考虑引入"元工具"或分层工具机制，允许 HFC 在需要时（如深度思考）访问更强大的工具，例如：
        - 修改自身或其他 `SubHeartflow` 的聊天参数。
        - 请求改变 Mai 的全局状态 (`MaiState`)。
        - 管理日程或执行更复杂的分析任务。
    - 目标：提升 HFC 的自主决策和行动能力，即使会增加一定的延迟。

- **基于历史学习的行为模式应用**:
    - **学习**: 分析过往聊天记录，提取和学习具体的行为模式（如特定梗的用法、情境化回应风格等）。可能需要专门的分析模块。
    - **存储与匹配**: 需要有效的方法存储学习到的行为模式，并开发强大的 **匹配** 机制，在运行时根据当前情境检索最合适的模式。**(匹配的准确性是关键)**
    - **应用与评估**: 将匹配到的行为模式融入 HFC 的决策和回复生成（例如，将其整合进 Prompt）。之后需评估该行为模式应用的实际效果。
    - **人格塑造**: 通过学习到的实际行为来动态塑造人格，作为静态人设描述的补充或替代，使其更生动自然。

- **标准化人设生成 (Standardized Persona Generation)**:
    - **目标**: 解决手动配置 `人设` 文件缺乏标准、难以全面描述个性的问题，并生成更丰富、可操作的人格资源。
    - **方法**: 利用大型语言模型 (LLM) 辅助生成标准化的、结构化的人格**资源包**。
    - **生成内容**: 不仅生成描述性文本（替代现有 `individual` 配置），还可以同时生成与该人格配套的：
        - **相关工具 (Tools)**: 该人格倾向于使用的工具或能力。
        - **初始记忆/知识库 (Memories/Knowledge)**: 定义其背景和知识基础。
        - **核心行为模式 (Core Behavior Patterns)**: 预置一些典型的行为方式，可作为行为学习的起点。
    - **实现途径**: 
        - 通过与 LLM 的交互式对话来定义和细化人格及其配套资源。
        - 让 LLM 分析提供的文本材料（如小说、背景故事）来提取人格特质和相关信息。
    - **优势**: 替代易出错且标准不一的手动配置，生成更丰富、一致、包含配套资源且易于系统理解和应用的人格包。

- **优化表情包处理与理解 (Enhanced Emoji Handling and Understanding)**:
    - **面临挑战**:
        - **历史记录表示**: 如何在聊天历史中有效表示表情包，供 LLM 理解。
        - **语义理解**: 如何让 LLM 准确把握表情包的含义、情感和语境。
        - **场景判断与选择**: 如何让 LLM 判断何时适合使用表情包，并选择最贴切的一个。
    - **目标**: 提升 Mai 理解和运用表情包的能力，使交互更自然生动。
    - **说明**: 可能需要较多时间进行数据处理和模型调优，但对改善体验潜力巨大。

- **探索高级记忆检索机制 (GE 系统概念):**
    - 研究超越简单关键词/近期性检索的记忆模型。
    - 考虑引入基于事件关联、相对时间线索和绝对时间锚点的检索方式。
    - 可能涉及设计新的事件表示或记忆结构。


- **实现 SubHeartflow 级记忆缓存池:**
    - 在 `SubHeartflow` 层级或更高层级设计并实现一个缓存池，存储已检索的记忆/信息。
    - 避免在 HFC 等循环中重复进行相同的记忆检索调用。
    - 确保存储的信息能有效服务于当前交互上下文。

- **基于人格生成预设知识:**
    - 开发利用 LLM 和人格配置生成背景知识的功能。
    - 这些知识应符合角色的行为风格和可能的经历。
    - 作为一种"冷启动"或丰富角色深度的方式。


## 开发计划TODO：LIST

- 人格功能：WIP
- 对特定对象的侧写功能
- 图片发送，转发功能：WIP
- 幽默和meme功能：WIP
- 小程序转发链接解析
- 自动生成的回复逻辑，例如自生成的回复方向，回复风格