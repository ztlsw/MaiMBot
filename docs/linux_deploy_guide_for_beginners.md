# é¢å‘çº¯æ–°æ‰‹çš„LinuxæœåŠ¡å™¨éº¦éº¦éƒ¨ç½²æŒ‡å—


## äº‹å‰å‡†å¤‡
ä¸ºäº†èƒ½ä½¿éº¦éº¦ä¸é—´æ–­çš„è¿è¡Œï¼Œä½ éœ€è¦ä¸€å°ä¸€ç›´å¼€ç€çš„æœåŠ¡å™¨ã€‚

### å¦‚æœä½ æƒ³è´­ä¹°æœåŠ¡å™¨
åä¸ºäº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ç­‰éƒ½æ˜¯åœ¨å›½å†…å¯ä»¥é€‰æ‹©çš„é€‰æ‹©ã€‚

ç§Ÿä¸€å°æœ€ä½é…ç½®çš„å°±è¶³æ•·éœ€è¦äº†ï¼ŒæŒ‰æœˆç§Ÿå¤§æ¦‚åå‡ å—é’±å°±èƒ½ç§Ÿåˆ°äº†ã€‚

### å¦‚æœä½ ä¸æƒ³è´­ä¹°æœåŠ¡å™¨
ä½ å¯ä»¥å‡†å¤‡ä¸€å°å¯ä»¥ä¸€ç›´å¼€ç€çš„ç”µè„‘/ä¸»æœºï¼Œåªéœ€è¦ä¿è¯èƒ½å¤Ÿæ­£å¸¸è®¿é—®äº’è”ç½‘å³å¯

**ä¸‹æ–‡å°†ç»Ÿç§°å®ƒä»¬ä¸º`æœåŠ¡å™¨`**

æˆ‘ä»¬å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€å°Linuxæ¶æ„çš„æœåŠ¡å™¨ã€‚ä¸¾ä¾‹ä½¿ç”¨çš„æ˜¯Ubuntu24.04ï¼Œå…¶ä»–çš„åŸç†ç›¸ä¼¼ã€‚

## 0.æˆ‘ä»¬å°±ä»é›¶å¼€å§‹å§

### ç½‘ç»œé—®é¢˜

ä¸ºè®¿é—®Githubç›¸å…³ç•Œé¢ï¼Œæ¨èå»ä¸‹ä¸€æ¬¾åŠ é€Ÿå™¨ï¼Œæ–°æ‰‹å¯ä»¥è¯•è¯•[Watt Toolkit](https://gitee.com/rmbgame/SteamTools/releases/latest)ã€‚

### å®‰è£…åŒ…ä¸‹è½½

#### MongoDB
è¿›å…¥[MongoDBä¸‹è½½é¡µ](https://www.mongodb.com/try/download/community-kubernetes-operator)ï¼Œå¹¶é€‰æ‹©ç‰ˆæœ¬

ä»¥Ubuntu24.04 x86ä¸ºä¾‹ï¼Œä¿æŒå¦‚å›¾æ‰€ç¤ºé€‰é¡¹ï¼Œç‚¹å‡»`Download`å³å¯ï¼Œå¦‚æœæ˜¯å…¶ä»–ç³»ç»Ÿï¼Œè¯·åœ¨`Platform`ä¸­è‡ªè¡Œé€‰æ‹©ï¼š

![](./pic/MongoDB_Ubuntu_guide.png)


ä¸æƒ³ä½¿ç”¨ä¸Šè¿°æ–¹å¼ï¼Ÿä½ ä¹Ÿå¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://www.mongodb.com/zh-cn/docs/manual/administration/install-on-linux/#std-label-install-mdb-community-edition-linux)è¿›è¡Œå®‰è£…ï¼Œè¿›å…¥åé€‰æ‹©è‡ªå·±çš„ç³»ç»Ÿç‰ˆæœ¬å³å¯

#### QQï¼ˆå¯é€‰ï¼‰/Napcat
*å¦‚æœä½ ä½¿ç”¨Napcatçš„è„šæœ¬å®‰è£…ï¼Œå¯ä»¥å¿½ç•¥æ­¤æ­¥*
è®¿é—®https://github.com/NapNeko/NapCatQQ/releases/latest
åœ¨å›¾ä¸­æ‰€ç¤ºåŒºåŸŸå¯ä»¥æ‰¾åˆ°QQçš„ä¸‹è½½é“¾æ¥ï¼Œé€‰æ‹©å¯¹åº”ç‰ˆæœ¬ä¸‹è½½å³å¯
ä»è¿™é‡Œä¸‹è½½ï¼Œå¯ä»¥ä¿è¯ä½ ä¸‹è½½åˆ°çš„QQç‰ˆæœ¬å…¼å®¹æœ€æ–°ç‰ˆNapcat
![](./pic/QQ_Download_guide_Linux.png)
å¦‚æœä½ ä¸æƒ³ä½¿ç”¨Napcatçš„è„šæœ¬å®‰è£…ï¼Œè¿˜éœ€å‚è€ƒ[Napcat-Linuxæ‰‹åŠ¨å®‰è£…](https://www.napcat.wiki/guide/boot/Shell-Linux-SemiAuto)

#### éº¦éº¦

å…ˆæ‰“å¼€https://github.com/MaiM-with-u/MaiBot/releases
å¾€ä¸‹æ»‘æ‰¾åˆ°è¿™ä¸ª
![ä¸‹è½½æŒ‡å¼•](./pic/linux_beginner_downloadguide.png "")
ä¸‹è½½ç®­å¤´æ‰€æŒ‡è¿™ä¸ªå‹ç¼©åŒ…ã€‚

### è·¯å¾„

æˆ‘æŠŠéº¦éº¦ç›¸å…³æ–‡ä»¶æ”¾åœ¨äº†/moi/maié‡Œé¢ï¼Œä½ å¯ä»¥å‡­å–œå¥½æ›´æ”¹ï¼Œè®°å¾—é€‚å½“è°ƒæ•´ä¸‹é¢æ¶‰åŠåˆ°çš„éƒ¨åˆ†å³å¯ã€‚

æ–‡ä»¶ç»“æ„ï¼š

```
moi
â””â”€ mai
   â”œâ”€ linuxqq_3.2.16-32793_amd64.deb   # linuxqqå®‰è£…åŒ…
   â”œâ”€ mongodb-org-server_8.0.5_amd64.deb  # MongoDBçš„å®‰è£…åŒ…
   â””â”€ bot
      â””â”€ MaiMBot-0.5.8-alpha.zip # éº¦éº¦çš„å‹ç¼©åŒ…
```

### ç½‘ç»œ

ä½ å¯ä»¥åœ¨ä½ çš„æœåŠ¡å™¨æ§åˆ¶å°ç½‘é¡µæ›´æ”¹é˜²ç«å¢™è§„åˆ™ï¼Œå…è®¸6099ï¼Œ8080ï¼Œ27017è¿™å‡ ä¸ªç«¯å£çš„å‡ºå…¥ã€‚

## 1.æ­£å¼å¼€å§‹ï¼

è¿œç¨‹è¿æ¥ä½ çš„æœåŠ¡å™¨ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªé»‘æ¡†æ¡†é—ªç€ç™½æ–¹æ ¼ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦è¿›è¡Œè®¾ç½®çš„åœºæ‰€â€”â€”ç»ˆç«¯äº†ã€‚ä»¥ä¸‹çš„bashå‘½ä»¤éƒ½æ˜¯åœ¨è¿™é‡Œè¾“å…¥ã€‚

## 2. Pythonçš„å®‰è£…

- å¯¼å…¥ Python çš„ç¨³å®šç‰ˆ PPAï¼ˆUbuntuéœ€æ‰§è¡Œæ­¤æ­¥ï¼ŒDebianå¯å¿½ç•¥ï¼‰ï¼š

```bash
sudo add-apt-repository ppa:deadsnakes/ppa
```

- å¯¼å…¥ PPA åï¼Œæ›´æ–° APT ç¼“å­˜ï¼š

```bash
sudo apt update
```

- åœ¨ã€Œç»ˆç«¯ã€ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… Python 3.12ï¼š

```bash
sudo apt install python3.12
```

- éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸï¼š

```bash
python3.12 --version
```
- ï¼ˆå¯é€‰ï¼‰æ›´æ–°æ›¿ä»£æ–¹æ¡ˆï¼Œè®¾ç½® python3.12 ä¸ºé»˜è®¤çš„ python3 ç‰ˆæœ¬:
```bash
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.12 1
sudo update-alternatives --config python3
```

- åœ¨ã€Œç»ˆç«¯ã€ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… pipï¼š

```bash
sudo apt install python3-pip
```

- æ£€æŸ¥Pipæ˜¯å¦å®‰è£…æˆåŠŸï¼š

```bash
pip --version
```

- å®‰è£…å¿…è¦ç»„ä»¶

``` bash
sudo apt install python-is-python3
```

## 3.MongoDBçš„å®‰è£…
*å¦‚æœä½ æ˜¯å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://www.mongodb.com/zh-cn/docs/manual/administration/install-on-linux/#std-label-install-mdb-community-edition-linux)è¿›è¡Œå®‰è£…çš„ï¼Œå¯è·³è¿‡æ­¤æ­¥*

``` bash
cd /moi/mai
```

``` bash
dpkg -i mongodb-org-server_8.0.5_amd64.deb
```

``` bash
mkdir -p /root/data/mongodb/{data,log}
```

## 4.MongoDBçš„è¿è¡Œ

```bash
service mongod start
```

```bash
systemctl status mongod #é€šè¿‡è¿™æ¡æŒ‡ä»¤æ£€æŸ¥è¿è¡ŒçŠ¶æ€
```

æœ‰éœ€è¦çš„è¯å¯ä»¥æŠŠè¿™ä¸ªæœåŠ¡æ³¨å†Œæˆå¼€æœºè‡ªå¯

```bash
sudo systemctl enable mongod
```

## 5.Napcatçš„å®‰è£…

``` bash
# è¯¥è„šæœ¬é€‚ç”¨äºæ”¯æŒUbuntu 20+/Debian 10+/Centos9
curl -o napcat.sh https://nclatest.znin.net/NapNeko/NapCat-Installer/main/script/install.sh && sudo bash napcat.sh
```
æ‰§è¡Œåï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å¸®ä½ éƒ¨ç½²å¥½QQåŠNapcat
*æ³¨ï¼šå¦‚æœä½ å·²ç»æ‰‹åŠ¨å®‰è£…äº†Napcatå’ŒQQï¼Œå¯å¿½ç•¥æ­¤æ­¥*

æˆåŠŸçš„æ ‡å¿—æ˜¯è¾“å…¥``` napcat ```å‡ºæ¥ç‚«é…·çš„å½©è™¹è‰²ç•Œé¢

## 6.Napcatçš„è¿è¡Œ

æ­¤æ—¶ä½ å°±å¯ä»¥æ ¹æ®æç¤ºåœ¨```napcat```é‡Œé¢ç™»å½•ä½ çš„QQå·äº†ã€‚

```bash
napcat start <ä½ çš„QQå·>
napcat status #æ£€æŸ¥è¿è¡ŒçŠ¶æ€
```

ç„¶åä½ å°±å¯ä»¥ç™»å½•napcatçš„webuiè¿›è¡Œè®¾ç½®äº†ï¼š

```http://<ä½ æœåŠ¡å™¨çš„å…¬ç½‘IP>:6099/webui?token=napcat```

å¦‚æœä½ éƒ¨ç½²åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šï¼š
```http://127.0.0.1:6099/webui?token=napcat```

> [!WARNING]
> å¦‚æœä½ çš„éº¦éº¦éƒ¨ç½²åœ¨å…¬ç½‘ï¼Œè¯·**åŠ¡å¿…**ä¿®æ”¹Napcatçš„é»˜è®¤å¯†ç 


ç¬¬ä¸€æ¬¡æ˜¯è¿™ä¸ªï¼Œåç»­æ”¹äº†å¯†ç ä¹‹åtokenå°±ä¼šå¯¹åº”ä¿®æ”¹ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨```napcat log <ä½ çš„QQå·>```æ¥æŸ¥çœ‹webuiåœ°å€ã€‚æŠŠé‡Œé¢çš„```127.0.0.1```æ”¹æˆ<ä½ æœåŠ¡å™¨çš„å…¬ç½‘IP>å³å¯ã€‚

ç™»å½•ä¸Šä¹‹ååœ¨ç½‘ç»œé…ç½®ç•Œé¢æ·»åŠ websocketå®¢æˆ·ç«¯ï¼Œåç§°éšä¾¿è¾“ä¸€ä¸ªï¼Œurlæ”¹æˆ`ws://127.0.0.1:8080/onebot/v11/ws`ä¿å­˜ä¹‹åç‚¹å¯ç”¨ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚

## 7.éº¦éº¦çš„å®‰è£…

### step 1 å®‰è£…è§£å‹è½¯ä»¶

```bash
sudo apt-get install unzip
```

### step 2 è§£å‹æ–‡ä»¶

```bash
cd /moi/mai/bot # æ³¨æ„ï¼šè¦åˆ‡æ¢åˆ°å‹ç¼©åŒ…çš„ç›®å½•ä¸­å»
unzip MaiMBot-0.5.8-alpha.zip
```

### step 3 è¿›å…¥è™šæ‹Ÿç¯å¢ƒå®‰è£…åº“

```bash
cd /moi/mai/bot
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### step 4 è¯•è¿è¡Œ

```bash
cd /moi/mai/bot
python -m venv venv
source venv/bin/activate
python bot.py
```

è‚¯å®šè¿è¡Œä¸æˆåŠŸï¼Œä¸è¿‡ä½ ä¼šå‘ç°ç»“æŸä¹‹åå¤šäº†ä¸€äº›æ–‡ä»¶

```
bot
â”œâ”€ .env.prod
â””â”€ config
   â””â”€ bot_config.toml
```

ä½ å¯ä»¥ä½¿ç”¨vimã€nanoç­‰ç¼–è¾‘å™¨ç›´æ¥åœ¨ç»ˆç«¯é‡Œä¿®æ”¹è¿™äº›é…ç½®æ–‡ä»¶ï¼Œä½†å¦‚æœä½ ä¸ç†Ÿæ‚‰å®ƒä»¬çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦å›¾å½¢ç•Œé¢çš„ç¼–è¾‘å™¨ã€‚
å¦‚æœä½ çš„éº¦éº¦éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒä»¬ä¸‹è½½åˆ°æœ¬åœ°æ”¹å¥½å†ä¼ ä¸Šå»

### step 5 æ–‡ä»¶é…ç½®

æœ¬é¡¹ç›®éœ€è¦é…ç½®ä¸¤ä¸ªä¸»è¦æ–‡ä»¶ï¼š

1. `.env.prod` - é…ç½®APIæœåŠ¡å’Œç³»ç»Ÿç¯å¢ƒ
2. `bot_config.toml` - é…ç½®æœºå™¨äººè¡Œä¸ºå’Œæ¨¡å‹

#### API

ä½ å¯ä»¥æ³¨å†Œä¸€ä¸ªç¡…åŸºæµåŠ¨çš„è´¦å·ï¼Œé€šè¿‡é‚€è¯·ç æ³¨å†Œæœ‰14å—é’±çš„å…è´¹é¢åº¦ï¼šhttps://cloud.siliconflow.cn/i/7Yld7cfgã€‚

#### ä¿®æ”¹é…ç½®æ–‡ä»¶
è¯·å‚è€ƒ
- [ğŸ€ æ–°æ‰‹é…ç½®æŒ‡å—](./installation_cute.md) - é€šä¿—æ˜“æ‡‚çš„é…ç½®æ•™ç¨‹ï¼Œé€‚åˆåˆæ¬¡ä½¿ç”¨çš„çŒ«å¨˜
- [âš™ï¸ æ ‡å‡†é…ç½®æŒ‡å—](./installation_standard.md) - ç®€æ˜ä¸“ä¸šçš„é…ç½®è¯´æ˜ï¼Œé€‚åˆæœ‰ç»éªŒçš„ç”¨æˆ·


### step 6 è¿è¡Œ

ç°åœ¨å†è¿è¡Œ

```bash
cd /moi/mai/bot
python -m venv venv
source venv/bin/activate
python bot.py
```

åº”è¯¥å°±èƒ½è¿è¡ŒæˆåŠŸäº†ã€‚

## 8.äº‹åé…ç½®

å¯æ˜¯ç°åœ¨è¿˜æœ‰ä¸ªé—®é¢˜ï¼šåªè¦ä½ ä¸€å…³é—­ç»ˆç«¯ï¼Œbot.pyå°±ä¼šåœæ­¢è¿è¡Œã€‚é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠbot.pyæ³¨å†ŒæˆæœåŠ¡ã€‚

é‡å¯æœåŠ¡å™¨ï¼Œæ‰“å¼€MongoDBå’ŒnapcatæœåŠ¡ã€‚

æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåä¸º`bot.service`ï¼Œå†…å®¹å¦‚ä¸‹

```
[Unit]
Description=maimai bot

[Service]
WorkingDirectory=/moi/mai/bot
ExecStart=/moi/mai/bot/venv/bin/python /moi/mai/bot/bot.py
Restart=on-failure
User=root

[Install]
WantedBy=multi-user.target
```

é‡Œé¢çš„è·¯å¾„è§†è‡ªå·±çš„æƒ…å†µæ›´æ”¹ã€‚

æŠŠå®ƒæ”¾åˆ°`/etc/systemd/system`é‡Œé¢ã€‚

é‡æ–°åŠ è½½ `systemd` é…ç½®ï¼š

```bash
sudo systemctl daemon-reload
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl start bot.service # å¯åŠ¨æœåŠ¡
sudo systemctl restart bot.service # æˆ–è€…é‡å¯æœåŠ¡
```

æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

```bash
sudo systemctl status bot.service
```

ç°åœ¨å†å…³é—­ç»ˆç«¯ï¼Œæ£€æŸ¥éº¦éº¦èƒ½ä¸èƒ½æ­£å¸¸å›å¤QQä¿¡æ¯ã€‚å¦‚æœå¯ä»¥çš„è¯å°±å¤§åŠŸå‘Šæˆäº†ï¼

## 9.å‘½ä»¤é€ŸæŸ¥

```bash
service mongod start # å¯åŠ¨mongodæœåŠ¡
napcat start <ä½ çš„QQå·> # ç™»å½•napcat
cd /moi/mai/bot # åˆ‡æ¢è·¯å¾„
python -m venv venv # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

sudo systemctl daemon-reload # é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl start bot.service # å¯åŠ¨botæœåŠ¡
sudo systemctl enable bot.service # å¯åŠ¨botæœåŠ¡

sudo systemctl status bot.service # æ£€æŸ¥botæœåŠ¡çŠ¶æ€
```

```bash
python bot.py  # è¿è¡Œéº¦éº¦
```

